From 0000000000000000000000000000000000000000 Mon Sep 17 00:00:00 2001
From: Telesphoreo <me@telesphoreo.me>
Date: Tue, 19 Apr 2022 19:03:51 -0500
Subject: [PATCH] Update for 1.18.2


diff --git a/src/main/java/com/destroystokyo/paper/PaperVersionFetcher.java b/src/main/java/com/destroystokyo/paper/PaperVersionFetcher.java
index f92610edcfb724374c69e66443eab60919ee955a..1531d21c6e73ae69ec728d107b917967e0c6222b 100644
--- a/src/main/java/com/destroystokyo/paper/PaperVersionFetcher.java
+++ b/src/main/java/com/destroystokyo/paper/PaperVersionFetcher.java
@@ -18,10 +18,12 @@ import java.io.*;
 import java.net.HttpURLConnection;
 import java.net.URL;
 import java.util.stream.StreamSupport;
+import org.bukkit.Bukkit;
 
 public class PaperVersionFetcher implements VersionFetcher {
     private static final java.util.regex.Pattern VER_PATTERN = java.util.regex.Pattern.compile("^([0-9\\.]*)\\-.*R"); // R is an anchor, will always give '-R' at end
-    private static final String GITHUB_BRANCH_NAME = getBranch();
+    // Scissors - This must be changed manually for update checking to work
+    private static final String GITHUB_BRANCH_NAME = "ver/1.18.2";
     private static final String DOWNLOAD_PAGE = "https://ci.plex.us.org/job/Scissors/job/" + GITHUB_BRANCH_NAME;
     private static @Nullable String mcVer;
 
@@ -56,15 +58,10 @@ public class PaperVersionFetcher implements VersionFetcher {
         return mcVer;
     }
 
-    // Scissors start - Allow getting git information
-    public static String getCommit() {
-        Map<String, String> attributes = JarManifests.MANIFEST_MAP;
-        return attributes.get("Git-Commit");
-    }
-
-    public static String getBranch() {
-        Map<String, String> attributes = JarManifests.MANIFEST_MAP;
-        return attributes.get("Git-Branch");
+    // Scissors start - Allow getting Git commit
+    private static String getCommit() {
+        final var manifest = JarManifests.manifest(Bukkit.getServer().getClass());
+        return manifest == null ? null : manifest.getMainAttributes().getValue("Git-Commit");
     }
     // Scissors end
 
diff --git a/src/main/java/net/minecraft/network/chat/NbtComponent.java b/src/main/java/net/minecraft/network/chat/NbtComponent.java
index e3dc56de3f91e03b1543257f72448a734d914ed7..8bb0544ef08eb0c221f06ddf96b63be5d02dc5ab 100644
--- a/src/main/java/net/minecraft/network/chat/NbtComponent.java
+++ b/src/main/java/net/minecraft/network/chat/NbtComponent.java
@@ -95,7 +95,8 @@ public abstract class NbtComponent extends BaseComponent implements ContextAware
                     return stream.map((string) -> {
                         return new TextComponent(string);
                     }).reduce((accumulator, current) -> {
-                        return accumulator.append(text).append(current);
+                        // Scissors - untested, likely needs fixing
+                        return (TextComponent)accumulator.append(text).append(current);
                     }).orElseGet(() -> {
                         return new TextComponent("");
                     });
